<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arpanam | Vedic Rituals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --saffron: #D45D12; --cream: #FDFBF7; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--cream); color: #2D241E; margin: 0; }
        h1, h2, h3 { font-family: 'Cinzel', serif; }
        .saffron-btn { background: var(--saffron); color: white; border: none; cursor: pointer; transition: 0.3s; padding: 1rem 2rem; font-weight: bold; width: 100%; border-radius: 4px; }
        .saffron-btn:hover { background: #b04b0d; transform: translateY(-2px); }
        .ritual-card { transition: 0.3s; border: 1px solid #E5D9C5; background: white; cursor: pointer; padding: 2rem; display: flex; flex-direction: column; justify-content: space-between; height: 100%; }
        .ritual-card:hover { border-color: var(--saffron); transform: translateY(-4px); }
        .hidden { display: none; }
        input, select, textarea { width: 100%; padding: 1rem; border: 1px solid #E5D9C5; background-color: #FFF9F2; margin-bottom: 1rem; border-radius: 4px; }
    </style>
</head>
<body>

    <header class="p-8 text-center border-b border-[#E5D9C5]">
        <h1 class="text-4xl tracking-widest text-[#D45D12] font-bold">ARPANAM</h1>
        <p class="text-xs uppercase tracking-[0.3em] opacity-60 mt-2">Authentic Vedic Sankalp</p>
    </header>

    <main class="max-w-6xl mx-auto p-6 md:py-16">
        <div id="lobby-view" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>

        <div id="detail-view" class="max-w-3xl mx-auto bg-white p-8 md:p-16 border border-[#E5D9C5] hidden">
            <button onclick="showLobby()" class="mb-8 opacity-50 text-sm">← BACK TO ALL RITUALS</button>
            <h2 id="detail-title" class="text-4xl mb-4 font-bold"></h2>
            <p id="detail-price" class="text-2xl text-[#D45D12] font-bold mb-8"></p>
            <p id="detail-desc" class="text-lg mb-10 opacity-90 leading-relaxed"></p>
            <button onclick="showForm()" class="saffron-btn text-xl">Start Sankalp Process</button>
        </div>

        <div id="form-view" class="max-w-2xl mx-auto bg-white p-8 md:p-12 border border-[#E5D9C5] hidden">
            <button onclick="showDetail()" class="mb-8 opacity-50 text-sm">← BACK</button>
            <h2 class="text-3xl mb-8">Sankalp Registration</h2>
            
            <div class="bg-[#FFF9F2] p-4 border-l-4 border-[#D45D12] mb-8 text-sm italic">
                Note: Exact <b>Muhurat timing</b> will be confirmed by our Acharya over WhatsApp after consulting the Panchang.
            </div>

            <form id="sankalp-form">
                <input type="text" id="form-name" placeholder="Full Name" required>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="form-gotra" placeholder="Gotra (Lineage)">
                    <input type="text" id="form-country" placeholder="Country" required>
                </div>
                
                <label id="date-label" class="text-xs uppercase tracking-widest opacity-60 mb-2 block">Preferred Date</label>
                <div id="date-input-container"></div>

                <div class="flex items-center space-x-3 p-3 bg-[#FFF9F2]/50 mb-6">
                    <input type="checkbox" id="form-flex" class="w-5 h-5 accent-[#D45D12]">
                    <label for="form-flex" class="text-sm cursor-pointer">Flexible with date for better Muhurat.</label>
                </div>

                <input type="text" id="form-whatsapp" placeholder="WhatsApp Number (+1...)" required>
                <textarea id="form-notes" placeholder="Special Instructions or Health Details"></textarea>

                <button type="submit" id="submit-btn" class="saffron-btn text-lg">Pay & Book via Razorpay</button>
            </form>
        </div>
    </main>

    <script>
        const SCRIPT_URL = "YOUR_APPS_SCRIPT_URL_HERE";
        
        const rituals = [
            { id: 1, name: "Satyanarayan Katha", price: 4500, usd: 54, type: "STANDARD", desc: "The traditional narration and puja for Lord Vishnu, bringing peace to the household." },
            { id: 2, name: "Naamkaran", price: 3100, usd: 38, type: "STANDARD", desc: "Authentic Vedic naming ceremony including Nakshatra analysis and blessings." },
            { id: 3, name: "Mahamrityunjaya", price: 8500, usd: 105, type: "EMERGENCY", desc: "Intense jaap performed by Vedic priests for recovery and protection against health hurdles." },
            { id: 4, name: "Navagraha Shanti", price: 7500, usd: 90, type: "STANDARD", desc: "Targeted prayers for the nine planets to smooth over career or health complications." },
            { id: 5, name: "Pitru Dosh", price: 21000, usd: 250, type: "PERIOD", desc: "Rituals performed at sacred ghats to provide peace to the souls of ancestors." },
            { id: 6, name: "Griha Pravesh", price: 15500, usd: 185, type: "STANDARD", desc: "A complete purification of your home. Includes Ganesh Homa and Vastu Shanti." }
        ];

        let selectedRitual = null;

        function renderLobby() {
            const lobby = document.getElementById('lobby-view');
            lobby.innerHTML = rituals.map(r => `
                <div class="ritual-card" onclick="selectRitual(${r.id})">
                    <h3 class="text-2xl mb-3">${r.name}</h3>
                    <p class="text-lg font-semibold text-[#D45D12]">₹${r.price.toLocaleString()} <span class="text-sm font-normal opacity-50">/ ~$${r.usd}</span></p>
                </div>
            `).join('');
        }

        function selectRitual(id) {
            selectedRitual = rituals.find(r => r.id === id);
            showDetail();
        }

        function showLobby() {
            document.getElementById('lobby-view').classList.remove('hidden');
            document.getElementById('detail-view').classList.add('hidden');
            document.getElementById('form-view').classList.add('hidden');
        }

        function showDetail() {
            document.getElementById('detail-title').innerText = selectedRitual.name;
            document.getElementById('detail-price').innerText = `Dakshina: ₹${selectedRitual.price.toLocaleString()} (~$${selectedRitual.usd})`;
            document.getElementById('detail-desc').innerText = selectedRitual.desc;
            
            document.getElementById('lobby-view').classList.add('hidden');
            document.getElementById('detail-view').classList.remove('hidden');
            document.getElementById('form-view').classList.add('hidden');
        }

        function showForm() {
            const dateLabel = document.getElementById('date-label');
            const container = document.getElementById('date-input-container');
            const submitBtn = document.getElementById('submit-btn');

            submitBtn.innerText = `Pay ₹${selectedRitual.price.toLocaleString()} & Book via Razorpay`;

            if (selectedRitual.type === 'PERIOD') {
                dateLabel.innerText = "Preferred Period";
                container.innerHTML = `
                    <select id="form-date" required>
                        <option value="">Select Period</option>
                        <option value="Pitru Paksha">Upcoming Pitru Paksha</option>
                        <option value="Amavasya Tithi">Amavasya (Monthly)</option>
                        <option value="Annual Tithi">Annual Tithi (Varshik)</option>
                    </select>`;
            } else if (selectedRitual.type === 'EMERGENCY') {
                dateLabel.innerText = "Timing Urgency";
                container.innerHTML = `
                    <select id="form-date" required>
                        <option value="ASAP">ASAP - Health Emergency</option>
                        <option value="Within 48 Hours">Within 48 Hours</option>
                        <option value="Specific Date">Specific Date</option>
                    </select>`;
            } else {
                dateLabel.innerText = "Preferred Date";
                const minDate = new Date(Date.now() + 172800000).toISOString().split('T')[0];
                container.innerHTML = `<input type="date" id="form-date" min="${minDate}" required>`;
            }

            document.getElementById('detail-view').classList.add('hidden');
            document.getElementById('form-view').classList.remove('hidden');
        }

        document.getElementById('sankalp-form').onsubmit = async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('submit-btn');
            const originalText = btn.innerText;
            
            btn.innerText = "Generating Secure Payment Link...";
            btn.disabled = true;

            // 1. Gather data to send to your backend
            const params = new URLSearchParams();
            params.append('Name', document.getElementById('form-name').value);
            params.append('Gotra', document.getElementById('form-gotra').value || 'NA');
            params.append('Puja', selectedRitual.name);
            params.append('Date', document.getElementById('form-date').value);
            params.append('Country', document.getElementById('form-country').value);
            params.append('WhatsApp', document.getElementById('form-whatsapp').value);
            params.append('Flexibility', document.getElementById('form-flex').checked ? 'Yes' : 'No');
            params.append('Notes', document.getElementById('form-notes').value || 'Standard');

            try {
                /** * 2. CALL THE BACKEND
                 * We remove 'no-cors' because we need to READ the response (the Link) 
                 * that your script generates.
                 */
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: params
                });

                const result = await response.json();

                if (result.status === "success" && result.paymentLink) {
                    // 3. SUCCESS: Redirect to the UNIQUE link the backend just made
                    btn.innerText = "Redirecting to Razorpay...";
                    window.location.href = result.paymentLink;
                } else {
                    throw new Error("Backend failed to return a link");
                }

            } catch (err) {
                console.error("Connection Error:", err);
                // Fallback: If the automated link fails, alert the user and we contact them manually
                alert("Sankalp Recorded! Our Acharya will WhatsApp your personal payment link shortly due to high traffic.");
                btn.innerText = originalText;
                btn.disabled = false;
            }
};

        renderLobby();
    </script>
</body>
</html>