<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arpanam | Sacred Rituals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body { background-color: #FFF9F2; color: #2D1E1B; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .ritual-card { transition: all 0.3s ease; border: 0.5px solid #E5D9C5; }
        .ritual-card:hover { border-color: #D45D12; background-color: white; }
        .saffron-btn { background-color: #D45D12; color: white; transition: all 0.3s; }
        .saffron-btn:hover { background-color: #B04A0D; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState } = React;

        const rituals = [
            { id: 1, name: "Griha Pravesh", price: 5100, desc: "Sanctify your new dwelling with Vastu Shanti.", details: "A complete purification of your home. Includes Ganesh Homa and Vastu Shanti to ensure peace and prosperity." },
            { id: 2, name: "Satyanarayan Katha", price: 1100, desc: "For family harmony and universal gratitude.", details: "The traditional 5-chapter narration and puja for Lord Vishnu, bringing peace to the household." },
            { id: 3, name: "Mahamrityunjaya", price: 2100, desc: "A powerful Vedic shield for health.", details: "Intense jaap performed by Vedic priests for recovery and protection against health hurdles." },
            { id: 4, name: "Pitru Dosh", price: 3100, desc: "Honoring ancestors at the banks of Ganga.", details: "Rituals performed at sacred ghats to provide peace to the souls of ancestors." },
            { id: 5, name: "Navagraha Shanti", price: 2500, desc: "Align energies to overcome life hurdles.", details: "Targeted prayers for the nine planets to smooth over career or health complications." },
            { id: 6, name: "Naamkaran", price: 2100, desc: "Bless your child's first milestone.", details: "Authentic Vedic naming ceremony including Nakshatra analysis and blessings." }
        ];

function App() {
            const [view, setView] = useState('LOBBY'); 
            const [activeRitual, setActiveRitual] = useState(null);
            const [formData, setFormData] = useState({ name: '', gotra: '', whatsapp: '', country: '' });
            const [status, setStatus] = useState('IDLE'); // IDLE, SUBMITTING, SUCCESS

            const selectRitual = (r) => {
                setActiveRitual(r);
                setView('DETAIL');
                window.scrollTo(0,0);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setStatus('SUBMITTING');
                
                const scriptURL = 'https://script.google.com/macros/s/AKfycbxJ30GbxjO0SZ8Xrf3qX6n2Wr_SWHZDwOjdVOcfnOflD2isXNqJgX0w9iSBR-2PAeNiqQ/exec';
                
                // We use URLSearchParams for better compatibility with Google Apps Script 'e.parameter'
                const params = new URLSearchParams();
                params.append('Name', formData.name);
                params.append('Gotra', formData.gotra);
                params.append('WhatsApp', formData.whatsapp);
                params.append('Country', formData.country);
                params.append('Puja', activeRitual.name);

                try {
                    // Note: We removed 'no-cors' so we can actually read the 'paymentLink' coming back
                    const response = await fetch(scriptURL + "?" + params.toString(), { 
                        method: 'POST'
                    });
                    
                    const result = await response.json();

                    if (result.status === 'success' && result.paymentLink) {
                        // Redirect user directly to Razorpay
                        window.location.href = result.paymentLink;
                    } else {
                        // Fallback to success message if no link is found
                        setStatus('SUCCESS');
                    }
                } catch (error) {
                    // Even if there's a CORS error, the data usually reaches the sheet. 
                    // We show the success screen as a fallback.
                    console.error("Submission error:", error);
                    setStatus('SUCCESS');
                }
            };

            if (status === 'SUCCESS') {
                return (
                    <div className="min-h-screen flex items-center justify-center px-6 text-center">
                        <div className="max-w-md">
                            <h2 className="text-4xl mb-6 font-bold">üôè Sankalp Recorded</h2>
                            <p className="text-lg opacity-80 mb-8">Your request for {activeRitual.name} has been received. Please continue to WhatsApp to finalize the timing.</p>
                            <a href={`https://wa.me/YOUR_PHONE_NUMBER?text=Hi, I just submitted a Sankalp for ${activeRitual.name}`} className="saffron-btn px-10 py-4 inline-block font-bold rounded-sm">Message on WhatsApp</a>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20">
                    <section className="py-20 px-6 text-center">
                        <h1 className="text-5xl md:text-6xl font-bold mb-6">Arpanam</h1>
                        <p className="text-xl opacity-80 italic max-w-2xl mx-auto leading-relaxed">Sacred rituals, thoughtfully arranged.</p>
                    </section>

                    <main className="max-w-5xl mx-auto px-6">
                        {view === 'LOBBY' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {rituals.map(r => (
                                    <div key={r.id} className="ritual-card p-10 bg-white/50 cursor-pointer" onClick={() => selectRitual(r)}>
                                        <h3 className="text-2xl mb-3">{r.name}</h3>
                                        <p className="opacity-70 mb-6">{r.desc}</p>
                                        <span className="text-xs uppercase tracking-widest text-[#D45D12] font-bold">Understand This Ritual ‚Üí</span>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'DETAIL' && (
                            <div className="bg-white p-8 md:p-16 border border-[#E5D9C5]">
                                <button onClick={() => setView('LOBBY')} className="mb-8 opacity-50 hover:opacity-100 text-sm">‚Üê BACK TO ALL RITUALS</button>
                                <h2 className="text-4xl mb-6">{activeRitual.name}</h2>
                                <p className="text-2xl font-bold text-[#D45D12] mb-6">Dakshina: ‚Çπ{activeRitual.price}</p> 
                                <p className="text-xl leading-relaxed opacity-90 mb-10">{activeRitual.details}</p>
                                <button onClick={() => setView('FORM')} className="saffron-btn px-10 py-4 text-lg font-bold">Proceed with this Ritual</button>
                            </div>
                        )}

                        {view === 'FORM' && (
                            <div className="bg-white p-8 md:p-16 border border-[#E5D9C5] max-w-2xl mx-auto">
                                <button onClick={() => setView('DETAIL')} className="mb-8 opacity-50 text-sm">‚Üê BACK</button>
                                <h2 className="text-3xl mb-8 font-bold">Sankalp Details</h2>
                                <form onSubmit={handleSubmit} className="space-y-6">
                                    <input required placeholder="Your Full Name" className="w-full p-4 border border-[#E5D9C5] bg-[#FFF9F2]" onChange={e => setFormData({...formData, name: e.target.value})} />
                                    <input placeholder="Gotra (Optional)" className="w-full p-4 border border-[#E5D9C5] bg-[#FFF9F2]" onChange={e => setFormData({...formData, gotra: e.target.value})} />
                                    <input required placeholder="WhatsApp Number" className="w-full p-4 border border-[#E5D9C5] bg-[#FFF9F2]" onChange={e => setFormData({...formData, whatsapp: e.target.value})} />
                                    <input required placeholder="Country" className="w-full p-4 border border-[#E5D9C5] bg-[#FFF9F2]" onChange={e => setFormData({...formData, country: e.target.value})} />
                                    <button type="submit" disabled={status === 'SUBMITTING'} className="saffron-btn w-full py-4 font-bold">
                                        {status === 'SUBMITTING' ? 'Connecting to Secure Payment...' : `Pay ‚Çπ${activeRitual.price} & Book via Razorpay`}
                                    </button>
                                </form>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>